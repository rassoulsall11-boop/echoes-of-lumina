<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GEMINI PROTOCOL - PAROXYSM</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --dark: #020205; --energy: #00f2ff; }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; touch-action: none; }
        
        #hud { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 100; width: 250px; text-align: center; }
        .energy-container { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border: 1px solid var(--neon); border-radius: 10px; margin-top: 5px; box-shadow: 0 0 10px var(--neon); }
        #energy-bar { width: 100%; height: 100%; background: var(--neon); transition: width 0.2s; }
        .status-text { font-size: 9px; text-transform: uppercase; letter-spacing: 3px; color: var(--neon); text-shadow: 0 0 5px var(--neon); }

        .action-tray { position: fixed; right: 30px; bottom: 40px; display: flex; flex-direction: column; gap: 15px; z-index: 200; }
        .skill-btn { 
            width: 75px; height: 75px; border-radius: 50%; border: 2px solid var(--neon); 
            background: rgba(0, 242, 255, 0.1); color: white; font-size: 9px; font-weight: bold;
            backdrop-filter: blur(8px); cursor: pointer; transition: 0.3s;
        }
        .skill-btn:active { transform: scale(1.1); background: var(--neon); color: black; }

        #joystick-zone { position: fixed; left: 40px; bottom: 40px; width: 120px; height: 120px; z-index: 200; }
        #joy-base { width: 100%; height: 100%; background: rgba(255,255,255,0.05); border: 2px solid rgba(0,242,255,0.2); border-radius: 50%; position: relative; }
        #joy-stick { width: 50px; height: 50px; background: var(--neon); border-radius: 50%; position: absolute; left: 35px; top: 35px; box-shadow: 0 0 15px var(--neon); }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/three@0.167.0/build/three.min.js"></script>
</head>
<body>

<div id="hud">
    <div class="status-text">ECHOES OF LUMINA : SYNC</div>
    <div class="energy-container"><div id="energy-bar"></div></div>
</div>

<div id="joystick-zone"><div id="joy-base"><div id="joy-stick"></div></div></div>

<div class="action-tray">
    <button class="skill-btn" onclick="creerGlace()">CRÉATION<br>GLACE</button>
    <button class="skill-btn" id="btn-travers" onclick="toggleIntangible()">TRAVERS</button>
</div>

<script>
    let scene, camera, renderer, clock, player;
    let moveDir = { x: 0, z: 0 };
    let energy = 100;
    let isMoving = false;
    let isIntangible = false;

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x010103);
        scene.fog = new THREE.FogExp2(0x010103, 0.02);

        camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // Lumières
        const hemi = new THREE.HemisphereLight(0x00f2ff, 0x050510, 1);
        scene.add(hemi);

        // Sol Grille Néon
        const grid = new THREE.GridHelper(1000, 100, 0x00f2ff, 0x222222);
        scene.add(grid);

        // Joueur (Tenue "Liquide")
        player = new THREE.Group();
        const mat = new THREE.MeshPhongMaterial({ color: 0xffffff, shininess: 100 });
        
        const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 1, 4, 8), mat);
        body.position.y = 1;
        player.add(body);
        
        // Tête avec "Visière"
        const head = new THREE.Mesh(new THREE.SphereGeometry(0.3, 16, 16), mat);
        head.position.y = 1.8;
        player.add(head);

        scene.add(player);
        clock = new THREE.Clock();

        setupJoystick();
        animate();
    }

    function setupJoystick() {
        const base = document.getElementById('joy-base');
        const stick = document.getElementById('joy-stick');
        
        const handleMove = (e) => {
            const r = base.getBoundingClientRect();
            const touch = e.touches ? e.touches[0] : e;
            let dx = touch.clientX - (r.left + r.width/2);
            let dy = touch.clientY - (r.top + r.height/2);
            const dist = Math.min(Math.sqrt(dx*dx+dy*dy), 40);
            const angle = Math.atan2(dy, dx);
            
            stick.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
            
            moveDir.x = Math.cos(angle) * (dist/40);
            moveDir.z = Math.sin(angle) * (dist/40);
            isMoving = dist > 5;
            player.rotation.y = -angle - Math.PI/2;
        };

        base.addEventListener('touchmove', handleMove);
        base.addEventListener('touchend', () => {
            stick.style.transform = 'translate(0,0)';
            moveDir = {x: 0, z: 0};
            isMoving = false;
        });
    }

    function toggleIntangible() {
        isIntangible = !isIntangible;
        const btn = document.getElementById('btn-travers');
        
        player.traverse(child => {
            if(child.isMesh) {
                child.material.transparent = true;
                child.material.opacity = isIntangible ? 0.3 : 1;
                child.material.color.set(isIntangible ? 0x00f2ff : 0xffffff);
            }
        });
        btn.style.boxShadow = isIntangible ? "0 0 20px #00f2ff" : "none";
    }

    function creerGlace() {
        if(energy < 15) return;
        energy -= 15;
        
        const iceGroup = new THREE.Group();
        const iceMat = new THREE.MeshPhongMaterial({ 
            color: 0x00f2ff, transparent: true, opacity: 0.7, flatShading: true 
        });

        for(let i=0; i<3; i++) {
            const chunk = new THREE.Mesh(new THREE.IcosahedronGeometry(0.5 + Math.random(), 0), iceMat);
            chunk.position.set(Math.random()-0.5, 0, Math.random()-0.5);
            iceGroup.add(chunk);
        }

        iceGroup.position.set(
            player.position.x + Math.sin(player.rotation.y)*2, 
            0.5, 
            player.position.z + Math.cos(player.rotation.y)*2
        );
        scene.add(iceGroup);
        
        setTimeout(() => scene.remove(iceGroup), 5000); // Disparaît après 5s
    }

    function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();
        const time = clock.getElapsedTime();

        if(isMoving) {
            let speed = isIntangible ? 0.25 : 0.15; // Plus rapide en "Travers"
            player.position.x += moveDir.x * speed;
            player.position.z += moveDir.z * speed;
            energy = Math.max(0, energy - 0.08);
        } else {
            // Récupération d'énergie via le corps/ondes
            energy = Math.min(100, energy + 0.1); 
            player.position.y = Math.sin(time * 2) * 0.1; // Flottaison idle
        }

        document.getElementById('energy-bar').style.width = energy + "%";

        // Caméra suit le joueur
        const camDist = 8;
        camera.position.lerp(new THREE.Vector3(
            player.position.x, 
            player.position.y + 5, 
            player.position.z + camDist
        ), 0.05);
        camera.lookAt(player.position);

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    init();
</script>
</body>
</html>
