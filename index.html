<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ECHOES OF LUMINA - AETHEL</title>
    <style>
        :root { --neon: #00f2ff; --dark: #050505; }
        body { margin: 0; background: var(--dark); color: white; font-family: 'Orbitron', sans-serif; overflow: hidden; touch-action: none; }
        
        /* Décor de fond */
        #map { position: absolute; width: 3000px; height: 3000px; background: 
            linear-gradient(rgba(0, 242, 255, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 242, 255, 0.05) 1px, transparent 1px);
            background-size: 100px 100px; z-index: 1; }

        /* Le Joueur (Design amélioré) */
        #player { 
            position: absolute; width: 40px; height: 40px; 
            background: white; border: 2px solid var(--neon);
            box-shadow: 0 0 20px var(--neon); border-radius: 8px;
            z-index: 10; left: 50%; top: 50%; transform: translate(-50%, -50%);
        }

        /* Interface (HUD) */
        #hud { position: fixed; top: 20px; left: 20px; right: 20px; z-index: 100; pointer-events: none; }
        .stat-bar { width: 200px; height: 10px; background: rgba(255,255,255,0.1); border: 1px solid var(--neon); border-radius: 5px; overflow: hidden; margin-bottom: 5px; }
        #energy-fill { width: 100%; height: 100%; background: var(--neon); transition: width 0.3s; }

        /* Magasin (Menu caché) */
        #shop-menu { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; height: 60%; background: rgba(0,0,0,0.9); border: 2px solid var(--neon);
            z-index: 200; padding: 20px; border-radius: 15px; text-align: center;
        }

        /* Boutons tactiles */
        .controls { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; z-index: 100; }
        #joy-base { width: 120px; height: 120px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; position: relative; }
        #joy-stick { width: 50px; height: 50px; background: var(--neon); border-radius: 50%; position: absolute; left: 35px; top: 35px; }
        
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .btn { width: 70px; height: 70px; border-radius: 50%; border: 2px solid var(--neon); background: rgba(0,242,255,0.1); color: var(--neon); font-size: 9px; font-weight: bold; }
        #shop-btn { position: fixed; top: 20px; right: 20px; background: gold; color: black; border: none; padding: 10px 20px; border-radius: 5px; z-index: 100; font-weight: bold; }
    </style>
</head>
<body>

<div id="hud">
    <div>ÉNERGIE CORPORELLE</div>
    <div class="stat-bar"><div id="energy-fill"></div></div>
    <div id="status">SECTEUR AETHEL-01</div>
</div>

<button id="shop-btn" onclick="toggleShop()">MAGASIN (SHOP)</button>

<div id="shop-menu">
    <h2>MAGASIN GEMINI</h2>
    <hr border="1" color="#00f2ff">
    <p>Amélioration Bracelet (Anti-rouille) - 500 Credits</p>
    <p>Texture Anti-trace (Tenue) - 300 Credits</p>
    <button onclick="toggleShop()" style="background:var(--neon); border:none; padding:10px 20px; margin-top:20px;">FERMER</button>
</div>

<div id="map"></div>
<div id="player"></div>

<div class="controls">
    <div id="joy-base"><div id="joy-stick"></div></div>
    <div class="action-btns">
        <button class="btn" onclick="creerGlace()">GLACE</button>
        <button class="btn" onclick="activerTravers()">TRAVERS</button>
    </div>
</div>

<script>
    const map = document.getElementById('map');
    const player = document.getElementById('player');
    const energyFill = document.getElementById('energy-fill');
    
    let px = window.innerWidth/2, py = window.innerHeight/2;
    let mx = 0, my = 0; // Position de la carte
    let vx = 0, vy = 0;
    let energy = 100;

    // Gestion Joystick Multi-touch
    const joyBase = document.getElementById('joy-base');
    const joyStick = document.getElementById('joy-stick');

    joyBase.addEventListener('touchmove', (e) => {
        const touch = e.touches[0];
        const rect = joyBase.getBoundingClientRect();
        const centerX = rect.left + rect.width/2;
        const centerY = rect.top + rect.height/2;
        
        let dx = touch.clientX - centerX;
        let dy = touch.clientY - centerY;
        const dist = Math.sqrt(dx*dx + dy*dy);
        
        if(dist > 50) { dx *= 50/dist; dy *= 50/dist; }
        
        joyStick.style.transform = `translate(${dx}px, ${dy}px)`;
        vx = dx / 10;
        vy = dy / 10;
    });

    joyBase.addEventListener('touchend', () => {
        joyStick.style.transform = 'translate(0,0)';
        vx = 0; vy = 0;
    });

    function loop() {
        // Au lieu de bouger le joueur, on bouge la carte (effet monde ouvert)
        mx -= vx; my -= vy;
        map.style.transform = `translate(${mx}px, ${my}px)`;
        
        // Consommation d'énergie si on bouge
        if(vx !== 0 || vy !== 0) {
            energy -= 0.05;
            if(energy < 0) energy = 0;
            energyFill.style.width = energy + "%";
        }
        
        requestAnimationFrame(loop);
    }
    loop();

    function toggleShop() {
        const shop = document.getElementById('shop-menu');
        shop.style.display = shop.style.display === 'block' ? 'none' : 'block';
    }

    function activerTravers() {
        player.style.opacity = player.style.opacity === "0.3" ? "1" : "0.3";
    }

    function creerGlace() {
        const bloc = document.createElement('div');
        bloc.style.cssText = `position:absolute; width:40px; height:40px; background:rgba(0,242,255,0.6); border:1px solid white; left:${window.innerWidth/2 - mx}px; top:${window.innerHeight/2 - my}px; z-index:5; box-shadow:0 0 15px var(--neon);`;
        map.appendChild(bloc);
    }
</script>
</body>
</html>
