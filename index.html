<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ú¶ GEMINI WORLD MOBILE ‚ú¶</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; user-select: none; }
        
        #ui-layer { position: fixed; inset: 0; pointer-events: none; z-index: 10; }
        
        /* Stats */
        .stats { position: absolute; top: 10px; left: 10px; pointer-events: none; }
        .bar-container { width: 180px; height: 15px; background: rgba(0,0,0,0.5); border: 1px solid cyan; border-radius: 5px; margin-bottom: 5px; overflow: hidden; }
        .bar-fill { height: 100%; width: 100%; transition: width 0.2s; background: cyan; box-shadow: 0 0 10px cyan; }
        #stamina-fill { background: #ffaa00; box-shadow: 0 0 10px #ffaa00; }

        /* Joystick Zone */
        #joystick-zone { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; pointer-events: auto; border: 1px solid rgba(0,242,255,0.3); }
        #joystick-stick { position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; background: cyan; border-radius: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 15px cyan; opacity: 0.6; }

        /* Mobile Skills */
        #actions { position: absolute; bottom: 30px; right: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px; pointer-events: auto; }
        .btn { width: 65px; height: 65px; border-radius: 50%; border: 2px solid cyan; background: rgba(0,20,40,0.7); color: white; font-size: 20px; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .btn:active { transform: scale(0.9); background: cyan; color: black; }
        .jump-btn { grid-column: span 2; width: 100%; border-radius: 30px; height: 50px; font-size: 14px; }

        #loading-screen { position: fixed; inset: 0; background: #000b1a; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #00f2ff; transition: 1s; }
    </style>
</head>
<body>

<div id="loading-screen"><h1>GEMINI WORLD</h1><p>Optimisation Mobile...</p></div>

<div id="ui-layer">
    <div class="stats">
        <div class="bar-container"><div id="energy-fill" class="bar-fill"></div></div>
        <div class="bar-container"><div id="stamina-fill" class="bar-fill"></div></div>
    </div>

    <div id="joystick-zone"><div id="joystick-stick"></div></div>

    <div id="actions">
        <button class="btn" onclick="castIce()">‚ùÑÔ∏è</button>
        <button class="btn" onclick="togglePhase()">üëª</button>
        <button class="btn jump-btn" onclick="jump()">SAUTER</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
    let scene, camera, renderer, player, clock;
    let stamina = 100, isPhasing = false;
    let moveDir = { x: 0, y: 0 }; // Pour le joystick
    let keys = {};
    let velocity = new THREE.Vector3();
    let canJump = true;

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x020a1a);
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);
        clock = new THREE.Clock();

        // Monde
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const grid = new THREE.GridHelper(500, 50, 0x00f2ff, 0x001122);
        scene.add(grid);

        // Player
        player = new THREE.Group();
        const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.5, 1, 4, 8), new THREE.MeshStandardMaterial({ color: 0x00f2ff }));
        body.position.y = 1;
        player.add(body);
        scene.add(player);

        setupControls();
        animate();
        setTimeout(() => document.getElementById('loading-screen').style.opacity = 0, 1500);
    }

    function setupControls() {
        // Keyboard
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        // Joystick Logic
        const zone = document.getElementById('joystick-zone');
        const stick = document.getElementById('joystick-stick');
        let active = false;

        const handleMove = (e) => {
            if(!active) return;
            const touch = e.touches ? e.touches[0] : e;
            const rect = zone.getBoundingClientRect();
            const centerX = rect.left + rect.width/2;
            const centerY = rect.top + rect.height/2;
            let dx = touch.clientX - centerX;
            let dy = touch.clientY - centerY;
            const dist = Math.min(60, Math.sqrt(dx*dx + dy*dy));
            const angle = Math.atan2(dy, dx);
            
            stick.style.left = `calc(50% + ${Math.cos(angle)*dist}px)`;
            stick.style.top = `calc(50% + ${Math.sin(angle)*dist}px)`;
            
            moveDir.x = Math.cos(angle) * (dist/60);
            moveDir.y = Math.sin(angle) * (dist/60);
        };

        zone.addEventListener('touchstart', (e) => { active = true; handleMove(e); });
        window.addEventListener('touchmove', handleMove);
        window.addEventListener('touchend', () => { 
            active = false; 
            stick.style.left = '50%'; stick.style.top = '50%';
            moveDir = { x: 0, y: 0 };
        });
    }

    function castIce() {
        const ice = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1.5, 1.5), new THREE.MeshBasicMaterial({ color: 0x00f2ff, wireframe: true }));
        const pos = new THREE.Vector3(0, 0.75, -3).applyQuaternion(player.quaternion);
        ice.position.copy(player.position).add(pos);
        scene.add(ice);
        setTimeout(() => scene.remove(ice), 3000);
    }

    function togglePhase() {
        isPhasing = !isPhasing;
        player.children[0].material.transparent = true;
        player.children[0].material.opacity = isPhasing ? 0.3 : 1;
    }

    function jump() { if(canJump) { velocity.y = 0.15; canJump = false; } }

    function animate() {
        requestAnimationFrame(animate);
        const delta = clock.getDelta();

        // Mouvement PC + Mobile
        let speed = 0.15;
        // Keyboard movement
        if (keys['KeyW']) player.translateZ(-speed);
        if (keys['KeyS']) player.translateZ(speed);
        if (keys['KeyA']) player.rotation.y += 0.05;
        if (keys['KeyD']) player.rotation.y -= 0.05;

        // Joystick movement
        if(Math.abs(moveDir.y) > 0.1) player.translateZ(moveDir.y * speed);
        player.rotation.y -= moveDir.x * 0.05;

        // Gravit√© / Saut
        player.position.y += velocity.y;
        if (player.position.y > 0) { velocity.y -= 0.008; } 
        else { player.position.y = 0; velocity.y = 0; canJump = true; }

        // Camera
        const camPos = new THREE.Vector3(0, 4, 8).applyQuaternion(player.quaternion);
        camera.position.lerp(player.position.clone().add(camPos), 0.1);
        camera.lookAt(player.position);

        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    init();
</script>
</body>
</html>
