<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>XEROX</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#000;color:#aaa;font-family:monospace;overflow:hidden}
canvas{display:block}
#ui{position:fixed;top:10px;left:10px;font-size:12px}
</style>
</head>
<body>

<div id="ui">XEROX</div>
<canvas id="c"></canvas>

<script>
// ===== CONFIG =====
const TILE = 32;
const CHUNK = 16;
const VIEW = 5;

// ===== CANVAS =====
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
resize();
window.onresize = resize;

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}

// ===== WORLD MEMORY =====
const Memory = JSON.parse(localStorage.getItem("XEROX")) || {
  zones:{},
  choices:{},
  quests:{}
};
function save(){localStorage.setItem("XEROX",JSON.stringify(Memory));}

// ===== PLAYER =====
const P={
  x:0,y:0,s:4,energy:100,intangible:false
};

// ===== INPUT =====
const keys={};
onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;

// mobile
let touchX=null;
canvas.ontouchstart=e=>touchX=e.touches[0].clientX;
canvas.ontouchend=()=>touchX=null;

// ===== GENERATORS =====
function rand(x,y){
  return Math.abs(Math.sin(x*12.9+y*78.2))*10000%1;
}

// BIOME / CIVILISATION
function zoneData(cx,cy){
  const id=cx+","+cy;
  if(Memory.zones[id]) return Memory.zones[id];

  const r=rand(cx,cy);
  const zone={
    biome:r<0.3?"plaine":r<0.6?"ruine":"infecté",
    city:r>0.7,
    infected:r>0.5,
    danger:Math.floor(r*10)
  };
  Memory.zones[id]=zone;
  save();
  return zone;
}

// QUEST GENERATOR
function generateQuest(zone){
  if(zone.biome==="infecté")
    return {type:"purge",reward:"mutation"};
  if(zone.city)
    return {type:"choix_politique",reward:"relation"};
  return {type:"exploration",reward:"souvenir"};
}

// ===== UPDATE =====
function update(){
  // movement
  if(keys.ArrowRight||touchX>innerWidth/2)P.x+=P.s;
  if(keys.ArrowLeft||touchX<innerWidth/2)P.x-=P.s;
  if(keys.Shift&&P.energy>0){
    P.intangible=true;
    P.energy-=0.5;
  }else{
    P.intangible=false;
    P.energy=Math.min(100,P.energy+0.2);
  }
}

// ===== DRAW =====
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx=Math.floor(P.x/(TILE*CHUNK));
  const cy=Math.floor(P.y/(TILE*CHUNK));

  for(let dx=-VIEW;dx<=VIEW;dx++)
  for(let dy=-VIEW;dy<=VIEW;dy++){
    const z=zoneData(cx+dx,cy+dy);
    const x=(dx*CHUNK*TILE)-(P.x%(CHUNK*TILE))+canvas.width/2;
    const y=(dy*CHUNK*TILE)-(P.y%(CHUNK*TILE))+canvas.height/2;

    ctx.fillStyle=
      z.biome==="plaine"?"#113311":
      z.biome==="ruine"?"#333":
      "#220022";
    ctx.fillRect(x,y,CHUNK*TILE,CHUNK*TILE);

    if(z.city){
      ctx.fillStyle="#ffaa00";
      ctx.fillRect(x+50,y+50,40,40);
    }
  }

  // PLAYER
  ctx.fillStyle=P.intangible?"rgba(180,0,255,0.6)":"#fff";
  ctx.fillRect(canvas.width/2-10,canvas.height/2-10,20,20);

  // UI
  ctx.fillStyle="#0ff";
  ctx.fillText("Énergie: "+Math.floor(P.energy),10,40);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
