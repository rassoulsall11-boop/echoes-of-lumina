<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>XEROX // MK-XVI</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

:root {
  --bg:#050508;
  --cyan:#00f3ff;
  --violet:#bc00ff;
}

body {
  margin:0;
  background:var(--bg);
  color:var(--cyan);
  font-family:'Share Tech Mono', monospace;
  overflow:hidden;
  touch-action:none;
}

canvas {
  display:block;
  margin:auto;
  background:#000;
}
</style>
</head>

<body>
<canvas id="c"></canvas>

<script>
/* ================= CORE CONFIG ================= */
const TILE = 64;
const VIEW = 6; // chunks autour du joueur
const CHUNK = 8; // tiles par chunk

/* ================= CANVAS ================= */
const c = document.getElementById("c");
const ctx = c.getContext("2d");

function resize(){
  c.width = window.innerWidth;
  c.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* ================= INPUT ================= */
const input = {x:0,y:0};

window.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft"||e.key==="a") input.x=-1;
  if(e.key==="ArrowRight"||e.key==="d") input.x=1;
  if(e.key==="ArrowUp"||e.key==="w") input.y=-1;
  if(e.key==="ArrowDown"||e.key==="s") input.y=1;
});
window.addEventListener("keyup", ()=>input.x=input.y=0);

c.addEventListener("touchmove", e=>{
  const t=e.touches[0];
  input.x = (t.clientX/c.width-0.5)*2;
  input.y = (t.clientY/c.height-0.5)*2;
});

/* ================= PLAYER ================= */
const player = {
  x:0,y:0,
  speed:4
};

/* ================= WORLD MEMORY ================= */
const world = new Map();

function seed(x,y){
  return Math.sin(x*127.1+y*311.7)*43758.5453%1;
}

function getTile(x,y){
  const k=x+","+y;
  if(world.has(k)) return world.get(k);
  const v = seed(x,y);
  const tile = v>0.6?"water":v>0.3?"ground":"void";
  world.set(k,tile);
  return tile;
}

/* ================= DRAW ================= */
function drawTile(x,y,t){
  if(t==="void") return;
  ctx.fillStyle = t==="ground"? "#1a1a1a" : "#002233";
  ctx.fillRect(x,y,TILE,TILE);
}

/* ================= LOOP ================= */
function loop(){
  // movement
  player.x += input.x * player.speed;
  player.y += input.y * player.speed;

  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.fillRect(0,0,c.width,c.height);

  const ox = Math.floor(player.x/TILE);
  const oy = Math.floor(player.y/TILE);

  for(let y=-VIEW;y<VIEW;y++){
    for(let x=-VIEW;x<VIEW;x++){
      const tx=ox+x;
      const ty=oy+y;
      const t = getTile(tx,ty);
      drawTile(
        c.width/2 + (tx*TILE-player.x),
        c.height/2 + (ty*TILE-player.y),
        t
      );
    }
  }

  // player
  ctx.fillStyle="white";
  ctx.shadowBlur=20;
  ctx.shadowColor="cyan";
  ctx.fillRect(c.width/2-10,c.height/2-10,20,20);
  ctx.shadowBlur=0;

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
